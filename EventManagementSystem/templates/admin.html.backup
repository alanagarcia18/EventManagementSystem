<!--
Admin Panel - Event Management System
System administration dashboard with platform statistics, user management, and venue control.

PAGE CONNECTIONS:
- FROM: Navigation (admin role only), Dashboard (admin quick access)
- TO: User Management (admin_users.html), Venue Management (admin_venues.html), System analytics

FUNCTIONALITY:
- Platform-wide statistics and metrics
- User management interface access
- Venue creation and management tools
- System health monitoring
- Administrative reporting
- AI assistant for administrative guidance
- Role-restricted access control

USER ROLES: Admin only - highest privilege level
SECURITY: Role-based access with @role_required('admin') decorator
DEPENDENCIES: Database statistics methods, user management functions
-->
{% extends "base.html" %}

{% block title %}Admin Panel - Event Manager{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1 class="page-title">
            <i class="fas fa-shield-alt"></i>
            Administration Panel
        </h1>
        <p class="page-subtitle">
            Manage users, venues, and monitor system health. Keep the community thriving!
        </p>
    </div>
    
    <!-- System Statistics -->
    <div class="grid grid-cols-4 mb-4">
        <div class="card text-center" style="background: linear-gradient(135deg, rgba(107, 115, 255, 0.1), rgba(107, 115, 255, 0.05)); border: 1px solid var(--primary-color);">
            <div style="font-size: 2.5rem; color: var(--primary-color); margin-bottom: 0.5rem;">
                <i class="fas fa-users"></i>
            </div>
            <h3 class="text-2xl font-bold text-primary">{{ stats.total_users }}</h3>
            <p class="text-secondary">Total Users</p>
        </div>
        
        <div class="card text-center" style="background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(255, 107, 157, 0.05)); border: 1px solid var(--secondary-color);">
            <div style="font-size: 2.5rem; color: var(--secondary-color); margin-bottom: 0.5rem;">
                <i class="fas fa-calendar-alt"></i>
            </div>
            <h3 class="text-2xl font-bold text-primary">{{ stats.total_events }}</h3>
            <p class="text-secondary">Total Events</p>
        </div>
        
        <div class="card text-center" style="background: linear-gradient(135deg, rgba(104, 211, 145, 0.1), rgba(104, 211, 145, 0.05)); border: 1px solid var(--success-color);">
            <div style="font-size: 2.5rem; color: var(--success-color); margin-bottom: 0.5rem;">
                <i class="fas fa-ticket"></i>
            </div>
            <h3 class="text-2xl font-bold text-primary">{{ stats.total_registrations }}</h3>
            <p class="text-secondary">Registrations</p>
        </div>
        
        <div class="card text-center" style="background: linear-gradient(135deg, rgba(246, 224, 94, 0.1), rgba(246, 224, 94, 0.05)); border: 1px solid var(--warning-color);">
            <div style="font-size: 2.5rem; color: var(--warning-color); margin-bottom: 0.5rem;">
                <i class="fas fa-map-marker-alt"></i>
            </div>
            <h3 class="text-2xl font-bold text-primary">{{ stats.total_venues }}</h3>
            <p class="text-secondary">Venues</p>
        </div>
    </div>
    
    <!-- Quick Actions -->
    <div class="grid grid-cols-3 mb-4">
        <a href="{{ url_for('admin_users') }}" class="card flex items-center gap-3" style="text-decoration: none; background: linear-gradient(135deg, rgba(107, 115, 255, 0.1), rgba(107, 115, 255, 0.05)); border: 1px solid var(--primary-color);">
            <div style="font-size: 2rem; color: var(--primary-color);">
                <i class="fas fa-users-cog"></i>
            </div>
            <div>
                <h4 class="font-semibold text-primary">Manage Users</h4>
                <p class="text-secondary text-sm">View and manage user accounts</p>
            </div>
        </a>
        
        <a href="{{ url_for('admin_venues') }}" class="card flex items-center gap-3" style="text-decoration: none; background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(255, 107, 157, 0.05)); border: 1px solid var(--secondary-color);">
            <div style="font-size: 2rem; color: var(--secondary-color);">
                <i class="fas fa-building"></i>
            </div>
            <div>
                <h4 class="font-semibold text-secondary">Manage Venues</h4>
                <p class="text-secondary text-sm">Add and manage event venues</p>
            </div>
        </a>
        
        <a href="{{ url_for('events') }}" class="card flex items-center gap-3" style="text-decoration: none; background: linear-gradient(135deg, rgba(104, 211, 145, 0.1), rgba(104, 211, 145, 0.05)); border: 1px solid var(--success-color);">
            <div style="font-size: 2rem; color: var(--success-color);">
                <i class="fas fa-calendar-check"></i>
            </div>
            <div>
                <h4 class="font-semibold text-success">View All Events</h4>
                <p class="text-secondary text-sm">Monitor system events</p>
            </div>
        </a>
    </div>
    
    <!-- User Role Distribution -->
    <div class="grid grid-cols-2 gap-4">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-chart-pie"></i>
                    User Distribution
                </h2>
            </div>
            
            <div class="flex flex-col gap-3">
                <div class="flex items-center justify-between p-3 rounded" style="background: rgba(107, 115, 255, 0.1); border: 1px solid rgba(107, 115, 255, 0.2);">
                    <div class="flex items-center gap-3">
                        <div style="font-size: 1.5rem; color: var(--primary-color);">
                            <i class="fas fa-user"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-primary">Attendees</h4>
                            <p class="text-sm text-secondary">Regular event participants</p>
                        </div>
                    </div>
                    <span class="text-xl font-bold text-primary">{{ stats.attendee_count }}</span>
                </div>
                
                <div class="flex items-center justify-between p-3 rounded" style="background: rgba(255, 107, 157, 0.1); border: 1px solid rgba(255, 107, 157, 0.2);">
                    <div class="flex items-center gap-3">
                        <div style="font-size: 1.5rem; color: var(--secondary-color);">
                            <i class="fas fa-users-cog"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-secondary">Organizers</h4>
                            <p class="text-sm text-secondary">Event creators and managers</p>
                        </div>
                    </div>
                    <span class="text-xl font-bold text-primary">{{ stats.organizer_count }}</span>
                </div>
                
                <div class="flex items-center justify-between p-3 rounded" style="background: rgba(246, 224, 94, 0.1); border: 1px solid rgba(246, 224, 94, 0.2);">
                    <div class="flex items-center gap-3">
                        <div style="font-size: 1.5rem; color: var(--warning-color);">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <div>
                            <h4 class="font-semibold text-warning">Administrators</h4>
                            <p class="text-sm text-secondary">System managers</p>
                        </div>
                    </div>
                    <span class="text-xl font-bold text-primary">{{ stats.admin_count }}</span>
                </div>
            </div>
        </div>
        
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-chart-line"></i>
                    System Health
                </h2>
            </div>
            
            <div class="flex flex-col gap-3">
                <div class="flex items-center justify-between p-3 rounded" style="background: rgba(104, 211, 145, 0.1); border: 1px solid rgba(104, 211, 145, 0.2);">
                    <div>
                        <h4 class="font-semibold text-success">Active Events</h4>
                        <p class="text-sm text-secondary">Events with registrations</p>
                    </div>
                    <span class="text-xl font-bold text-primary">{{ stats.events_with_registrations }}</span>
                </div>
                
                <div class="flex items-center justify-between p-3 rounded" style="background: rgba(99, 179, 237, 0.1); border: 1px solid rgba(99, 179, 237, 0.2);">
                    <div>
                        <h4 class="font-semibold text-info">Average Attendance</h4>
                        <p class="text-sm text-secondary">Per event registration rate</p>
                    </div>
                    <span class="text-xl font-bold text-primary">
                        {% if stats.total_events > 0 %}
                            {{ (stats.total_registrations / stats.total_events)|round(1) }}
                        {% else %}
                            0
                        {% endif %}
                    </span>
                </div>
                
                <div class="flex items-center justify-between p-3 rounded" style="background: rgba(160, 174, 192, 0.1); border: 1px solid rgba(160, 174, 192, 0.2);">
                    <div>
                        <h4 class="font-semibold text-secondary">Platform Usage</h4>
                        <p class="text-sm text-secondary">Overall engagement level</p>
                    </div>
                    <span class="text-xl font-bold text-primary">
                        {% if stats.total_users > 0 %}
                            {{ ((stats.total_registrations / stats.total_users) * 100)|round }}%
                        {% else %}
                            0%
                        {% endif %}
                    </span>
                </div>
                
                <div class="p-3 rounded text-center" style="background: linear-gradient(135deg, rgba(104, 211, 145, 0.1), rgba(107, 115, 255, 0.1)); border: 1px solid rgba(104, 211, 145, 0.3);">
                    <div style="font-size: 2rem; color: var(--success-color); margin-bottom: 0.5rem;">
                        <i class="fas fa-heart"></i>
                    </div>
                    <h4 class="font-semibold text-success">System Status: Healthy</h4>
                    <p class="text-sm text-secondary">All systems operational</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Admin Personal Dashboard -->
    <div class="card" style="margin: 2rem 0;">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-user-shield"></i>
                Your Personal Dashboard
            </h3>
            <p class="card-subtitle">
                Admin features with regular user capabilities
            </p>
        </div>
        
        <div class="grid grid-cols-3 gap-4 mb-4">
            <!-- Browse Events -->
            <a href="{{ url_for('events') }}" class="card flex items-center gap-3 hover-lift" 
               style="text-decoration: none; background: linear-gradient(135deg, rgba(107, 115, 255, 0.1), rgba(107, 115, 255, 0.05)); border: 1px solid var(--primary-color);">
                <div style="font-size: 2rem; color: var(--primary-color);">
                    <i class="fas fa-search"></i>
                </div>
                <div>
                    <h4 class="font-semibold text-primary">Browse Events</h4>
                    <p class="text-secondary text-sm">Discover and join events</p>
                </div>
            </a>
            
            <!-- Create Event -->
            <a href="{{ url_for('create_event') }}" class="card flex items-center gap-3 hover-lift" 
               style="text-decoration: none; background: linear-gradient(135deg, rgba(255, 107, 157, 0.1), rgba(255, 107, 157, 0.05)); border: 1px solid var(--secondary-color);">
                <div style="font-size: 2rem; color: var(--secondary-color);">
                    <i class="fas fa-plus-circle"></i>
                </div>
                <div>
                    <h4 class="font-semibold text-secondary">Create Event</h4>
                    <p class="text-secondary text-sm">Host your own events</p>
                </div>
            </a>
            
            <!-- My Registrations -->
            <a href="{{ url_for('my_registrations') }}" class="card flex items-center gap-3 hover-lift" 
               style="text-decoration: none; background: linear-gradient(135deg, rgba(104, 211, 145, 0.1), rgba(104, 211, 145, 0.05)); border: 1px solid var(--success-color);">
                <div style="font-size: 2rem; color: var(--success-color);">
                    <i class="fas fa-ticket-alt"></i>
                </div>
                <div>
                    <h4 class="font-semibold text-success">My Events</h4>
                    <p class="text-secondary text-sm">View your registrations</p>
                </div>
            </a>
        </div>
        
        <!-- AI Assistant Access -->
        <div class="card" style="background: linear-gradient(135deg, rgba(139, 124, 246, 0.1), rgba(139, 124, 246, 0.05)); border: 1px solid var(--primary-color);">
            <div class="flex items-center gap-3 mb-3">
                <div style="font-size: 2rem; color: var(--primary-color);">
                    <i class="fas fa-robot"></i>
                </div>
                <div>
                    <h4 class="font-semibold text-primary">AI Event Assistant</h4>
                    <p class="text-secondary text-sm">Get personalized event planning help and administrative guidance</p>
                </div>
            </div>
            
            <button onclick="toggleAIAssistant()" class="btn btn-primary">
                <i class="fas fa-comments"></i>
                Chat with AI Assistant
            </button>
        </div>
    </div>

    <!-- Events Management Section -->
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">
                <i class="fas fa-calendar-alt"></i>
                Events Management
            </h3>
            <p class="card-subtitle">
                Review and manage all events in the system
            </p>
        </div>
        
        {% if events %}
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Event Title</th>
                        <th>Organizer</th>
                        <th>Venue</th>
                        <th>Date</th>
                        <th>Registrations</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for event in events %}
                    <tr>
                        <td>
                            <div class="flex items-center gap-2">
                                <i class="fas fa-calendar-day text-primary"></i>
                                <span class="font-semibold">{{ event.title }}</span>
                            </div>
                        </td>
                        <td>{{ event.organizer_name or 'Unknown' }}</td>
                        <td>{{ event.venue_name or 'No venue' }}</td>
                        <td>{{ event.start or 'Not scheduled' }}</td>
                        <td>
                            <span class="status-badge status-info">
                                {{ event.registered_count or 0 }}/{{ event.capacity or 'âˆž' }}
                            </span>
                        </td>
                        <td>
                            <div class="flex gap-2">
                                <a href="{{ url_for('event_detail', event_id=event.id) }}" 
                                   class="btn btn-sm btn-outline" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <form method="POST" action="{{ url_for('delete_event', event_id=event.id) }}" 
                                      style="display: inline;" 
                                      onsubmit="return confirm('Are you sure you want to delete this event? This action cannot be undone.');">
                                    <button type="submit" class="btn btn-sm btn-danger" title="Delete Event">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <i class="fas fa-calendar-times"></i>
            <h4>No events found</h4>
            <p>There are no events in the system yet.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
